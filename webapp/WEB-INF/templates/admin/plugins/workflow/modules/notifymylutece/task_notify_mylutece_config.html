<#include "/admin/util/editor/editor.html" />

<#assign sender_name = default_sender_name>
<#assign subject = "">
<#assign message = "">
<#assign position_entry_directory_user_guid = -1>
<#assign id_directory = -1>
<#if config?exists>
	<#assign sender_name = config.senderName>
	<#assign subject = config.subject>
	<#assign message = config.message>
	<#assign position_entry_directory_user_guid = config.positionEntryDirectoryUserGuid>
	<#assign id_directory = config.idDirectory>
</#if>

<#function isNotify config id_notification_type>
	<#if config?? && config.listIdsNotificationType?? && config.listIdsNotificationType?has_content>
		<#list config.listIdsNotificationType as id>
			<#if id_notification_type = "" + id>
				<#return true>
			</#if>
		</#list>
	</#if>
	<#return false>
</#function>

<#function isRetrieve config id_retrieval_type>
	<#if config?? && config.listIdsRetrievalType?? && config.listIdsRetrievalType?has_content>
		<#list config.listIdsRetrievalType as id>
			<#if id_retrieval_type = "" + id>
				<#return true>
			</#if>
		</#list>
	</#if>
	<#return false>
</#function>

<h2>#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.title}</h2>
<div class="highlight-box">
	<#if notification_types?? && notification_types?has_content>
		<p>
			<label for="notification_type">#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.label_notification_type} * :</label>
			<#assign is_first = true>
			<#list notification_types?keys as id_notification_type>
				<#if !is_first>
					<label>&nbsp;</label>
				<#else>
					<#assign is_first = false>
				</#if>
				<#assign notification_type = notification_types[id_notification_type]>
				<input type="checkbox" name="notification_type" value="${id_notification_type}"
					<#if config?? && isNotify( config, id_notification_type )>
						checked="checked"
					</#if>
				/>&nbsp;${notification_type.getTitle( locale )}
				<#if notification_type.getComment( locale )?? && notification_type.getComment( locale ) != ''>
					(${notification_type.getComment( locale )})
				</#if>
				<br />
			</#list>
		</p>
	</#if>
	<#if retrieval_types?? && retrieval_types?has_content>
		<p>
			<label for="retrieval_type">#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.label_retrieval_type} * :</label>
			<#list retrieval_types?keys as id_retrieval_type>
				<#assign retrieval_type = retrieval_types[id_retrieval_type]>
				<input type="checkbox" name="retrieval_type" value="${id_retrieval_type}"
					<#if config?? && isRetrieve( config, id_retrieval_type)>
						checked="checked"
					</#if>
				/>&nbsp;${retrieval_type.getTitle( locale )}
			</#list>
		</p>
	</#if>
	<p>
		<label for="id_directory">#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.label_task_directory} * :</label>
		<@combo name="id_directory" items=list_directories default_value=id_directory />
	</p>
	<#if config?? && isRetrieve( config, "1" ) && list_entries?? && list_entries?has_content>
		<p id="entry_user_guid">
			<label for="position_entry_directory_user_guid">#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.label_task_entry_directory_user_guid} * :</label>
			<@combo name="position_entry_directory_user_guid" items=list_entries default_value=position_entry_directory_user_guid />&nbsp;
			<br/>
			<label>&nbsp;</label>
			#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.label_task_entry_directory_user_guid_comment}
		</p>
	</#if>
	<p>
		<input class="button" type="submit" name="apply" value="#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.label_apply}"/>
	</p>
	<#if config?? && isRetrieve( config, "2" )>
		<table>
			<tr>
				<th>#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.label_available_users}</th>
				<th>&nbsp;</th>
				<th>#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.label_selected_users}</th>
			</tr>
			<tr>
				<td>
					<@comboWithParamsAndLength name="select_users" default_value="" additionalParameters="multiple='multiple' size='10' style='width:100%;'" items=available_users_list max_length=175 />
				</td>
				<td>
					<div align="center">
						<input class="button" type="submit" name="apply" value="#i18n{module.workflow.notifymylutece.task_notify_mylutece_config.label_select_unselect_users}" />
					</div>
				</td>
				<td>
					<@comboWithParamsAndLength name="unselect_users" default_value="" additionalParameters="multiple='multiple' size='10' style='width:100%;'" items=selected_users_list max_length=175 />
				</td>
			</tr>
		</table>
	</#if>
	<br />
</div>

<#include "/admin/plugins/workflow/modules/notifymylutece/include/notification_config.html" />

<@initEditor />
